<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WorkplaceWellness ä¿®å¤éªŒè¯æµ‹è¯•</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
      background-color: #f8fafc;
    }
    .header {
      text-align: center;
      margin-bottom: 30px;
    }
    .test-container {
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
    }
    .test-section {
      background: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
    }
    .test-item {
      margin: 15px 0;
      padding: 15px;
      border-radius: 6px;
      border-left: 4px solid #e5e7eb;
      transition: all 0.3s ease;
    }
    .test-item.pending {
      border-left-color: #f59e0b;
      background-color: #fffbeb;
    }
    .test-item.running {
      border-left-color: #3b82f6;
      background-color: #eff6ff;
      animation: pulse 1.5s infinite;
    }
    .test-item.passed {
      border-left-color: #10b981;
      background-color: #f0fdf4;
    }
    .test-item.failed {
      border-left-color: #ef4444;
      background-color: #fef2f2;
    }
    .test-status {
      font-weight: bold;
      margin-bottom: 10px;
    }
    .test-details {
      font-family: monospace;
      font-size: 14px;
      color: #6b7280;
      white-space: pre-wrap;
    }
    .controls {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    }
    .btn:disabled {
      background: #9ca3af;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    .summary {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-top: 20px;
      box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
    }
    .progress-bar {
      width: 100%;
      height: 10px;
      background: #e5e7eb;
      border-radius: 4px;
      overflow: hidden;
      margin: 10px 0;
    }
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #10b981 0%, #059669 100%);
      transition: width 0.3s ease;
    }
    .note {
      background-color: #eff6ff;
      border-left: 4px solid #3b82f6;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 6px;
    }
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.7; }
      100% { opacity: 1; }
    }
    .test-window-info {
      background-color: #f0fdf4;
      border-left: 4px solid #10b981;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 6px;
      display: none;
    }
    .error-message {
      background-color: #fef2f2;
      border-left: 4px solid #ef4444;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 6px;
      display: none;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>ğŸ§ª WorkplaceWellness ä¿®å¤éªŒè¯æµ‹è¯•</h1>
    <p>è‡ªåŠ¨æµ‹è¯•éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒçš„ä¿®å¤æ•ˆæœ</p>
  </div>

  <div class="note">
    <strong>æ³¨æ„ï¼š</strong>æ­¤æµ‹è¯•å°†æ‰“å¼€ä¸€ä¸ªæ–°çª—å£æ¥éªŒè¯ä¿®å¤æ•ˆæœã€‚è¯·ç¡®ä¿æ‚¨çš„æµè§ˆå™¨å…è®¸å¼¹å‡ºçª—å£ã€‚
  </div>

  <div class="test-window-info" id="testWindowInfo">
    <strong>æµ‹è¯•çª—å£å·²æ‰“å¼€</strong>
    <p>æµ‹è¯•å°†åœ¨æ–°æ‰“å¼€çš„çª—å£ä¸­è‡ªåŠ¨è¿è¡Œã€‚è¯·å‹¿å…³é—­è¯¥çª—å£ç›´åˆ°æµ‹è¯•å®Œæˆã€‚</p>
  </div>

  <div class="error-message" id="errorMessage">
    <strong>é”™è¯¯ï¼š</strong>
    <span id="errorText"></span>
  </div>

  <div class="controls">
    <button class="btn" id="startBtn" onclick="startTests()">å¼€å§‹æµ‹è¯•</button>
    <button class="btn" onclick="resetTests()">é‡ç½®æµ‹è¯•</button>
    <button class="btn" onclick="openTestSite()">æ‰“å¼€æµ‹è¯•é¡µé¢</button>
  </div>
  <div class="progress-bar">
    <div class="progress-fill" id="progressBar" style="width: 0%"></div>
  </div>

  <div class="test-container">
    <div class="test-section">
      <h2>æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•</h2>
      <div id="coreTests"></div>
    </div>

    <div class="test-section">
      <h2>è¾¹ç•Œæƒ…å†µæµ‹è¯•</h2>
      <div id="edgeCaseTests"></div>
    </div>
  </div>

  <div class="summary">
    <h2>æµ‹è¯•æ€»ç»“</h2>
    <div id="testSummary">å‡†å¤‡å¼€å§‹æµ‹è¯•...</div>
  </div>

  <script>
    const testUrl = 'https://www.periodhub.health/zh/interactive-tools/workplace-wellness';
    const testResults = {
      core: [],
      edgeCase: []
    };
    let testCount = 0;
    let completedTests = 0;
    let testWindow = null;
    let testInterval = null;

    // æµ‹è¯•å®šä¹‰
    const testDefinitions = {
      core: [
        {
          name: 'é¡µé¢åŠ è½½æµ‹è¯•',
          id: 'pageLoad',
          description: 'æ£€æŸ¥é¡µé¢æ˜¯å¦æ­£å¸¸åŠ è½½',
          fn: testPageLoad
        },
        {
          name: 'æ•°æ®æŒä¹…åŒ–æµ‹è¯•',
          id: 'dataPersistence',
          description: 'æ£€æŸ¥ç»æœŸæ•°æ®æ˜¯å¦æ­£ç¡®ä¿å­˜å’Œæ˜¾ç¤º',
          fn: testDataPersistence
        },
        {
          name: 'å›¾è¡¨æ˜¾ç¤ºæµ‹è¯•',
          id: 'chartDisplay',
          description: 'æ£€æŸ¥å‘¨æœŸå›¾è¡¨æ˜¯å¦æ­£ç¡®æ¸²æŸ“',
          fn: testChartDisplay
        },
        {
          name: 'æŒ‰é’®ä½ç½®æµ‹è¯•',
          id: 'buttonPosition',
          description: 'æ£€æŸ¥æŒ‰é’®ä½ç½®æ˜¯å¦åˆé€‚',
          fn: testButtonPosition
        }
      ],
      edgeCase: [
        {
          name: 'ç©ºæ•°æ®å¤„ç†æµ‹è¯•',
          id: 'emptyData',
          description: 'æ£€æŸ¥ç©ºæ•°æ®æ—¶çš„é¡µé¢è¡Œä¸º',
          fn: testEmptyData
        },
        {
          name: 'å¤§é‡æ•°æ®å¤„ç†æµ‹è¯•',
          id: 'largeData',
          description: 'æ£€æŸ¥å¤§é‡æ•°æ®æ—¶çš„æ€§èƒ½è¡¨ç°',
          fn: testLargeData
        },
        {
          name: 'å®‰å…¨æ€§æµ‹è¯•',
          id: 'security',
          description: 'æ£€æŸ¥æ˜¯å¦å­˜åœ¨å®‰å…¨éšæ‚£',
          fn: testSecurity
        }
      ]
    };

    // åˆå§‹åŒ–æµ‹è¯•ç•Œé¢
    function initializeTests() {
      renderTestSection('core', testDefinitions.core);
      renderTestSection('edgeCase', testDefinitions.edgeCase);
      updateProgress();
    }

    // æ¸²æŸ“æµ‹è¯•åŒºåŸŸ
    function renderTestSection(section, tests) {
      const container = document.getElementById(`${section}Tests`);
      container.innerHTML = tests.map(test => `
        <div class="test-item pending" id="${test.id}">
          <div class="test-status">â³ ${test.name}</div>
          <div class="test-details">${test.description}</div>
        </div>
      `).join('');
    }

    // æ‰“å¼€æµ‹è¯•çª—å£
    function openTestSite() {
      window.open(testUrl, '_blank');
    }

    // è·å–æµ‹è¯•çª—å£å¼•ç”¨
    function getTestWindow() {
      if (!testWindow || testWindow.closed) {
        testWindow = window.open(testUrl, 'testWindow', 'width=1200,height=800');
        if (!testWindow) {
          showError('æ— æ³•æ‰“å¼€æµ‹è¯•çª—å£ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨å¼¹çª—è®¾ç½®');
          return null;
        }

        // æ˜¾ç¤ºæµ‹è¯•çª—å£ä¿¡æ¯
        document.getElementById('testWindowInfo').style.display = 'block';

        // ç­‰å¾…çª—å£åŠ è½½å®Œæˆ
        testWindow.addEventListener('load', () => {
          console.log('æµ‹è¯•çª—å£å·²åŠ è½½å®Œæˆ');
        });
      }
      return testWindow;
    }

    // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
    function showError(message) {
      document.getElementById('errorText').textContent = message;
      document.getElementById('errorMessage').style.display = 'block';
    }

    // éšè—é”™è¯¯ä¿¡æ¯
    function hideError() {
      document.getElementById('errorMessage').style.display = 'none';
    }

    // åœ¨æµ‹è¯•çª—å£ä¸­æ‰§è¡Œä»£ç 
    function executeInTestWindow(code) {
      return new Promise((resolve, reject) => {
        const testWin = getTestWindow();
        if (!testWin) {
          reject(new Error('æ— æ³•æ‰“å¼€æµ‹è¯•çª—å£'));
          return;
        }

        // æ£€æŸ¥çª—å£æ˜¯å¦å®Œå…¨åŠ è½½
        if (testWin.document.readyState !== 'complete') {
          testWin.addEventListener('load', () => {
            try {
              const result = testWin.eval(code);
              resolve(result);
            } catch (error) {
              reject(error);
            }
          }, { once: true });
        } else {
          try {
            const result = testWin.eval(code);
            resolve(result);
          } catch (error) {
            reject(error);
          }
        }
      });
    }

    // å¼€å§‹æµ‹è¯•
    async function startTests() {
      hideError();
      const startBtn = document.getElementById('startBtn');
      startBtn.disabled = true;
      startBtn.textContent = 'æµ‹è¯•è¿›è¡Œä¸­...';

      // åˆå§‹åŒ–æµ‹è¯•çª—å£
      const testWin = getTestWindow();
      if (!testWin) {
        startBtn.disabled = false;
        startBtn.textContent = 'å¼€å§‹æµ‹è¯•';
        return;
      }

      // è®¡ç®—æ€»æµ‹è¯•æ•°
      const allTests = [
        ...testDefinitions.core,
        ...testDefinitions.edgeCase
      ];
      testCount = allTests.length;
      completedTests = 0;

      // ä¾æ¬¡æ‰§è¡Œæµ‹è¯•
      for (const test of testDefinitions.core) {
        await runTest(test, 'core');
      }

      for (const test of testDefinitions.edgeCase) {
        await runTest(test, 'edgeCase');
      }

      // å®Œæˆæµ‹è¯•
      completeTests();
      startBtn.disabled = false;
      startBtn.textContent = 'å¼€å§‹æµ‹è¯•';
    }

    // è¿è¡Œå•ä¸ªæµ‹è¯•
    async function runTest(test, category) {
      const element = document.getElementById(test.id);
      element.className = 'test-item running';
      element.querySelector('.test-status').textContent = `ğŸ”„ ${test.name}`;
      element.querySelector('.test-details').textContent = 'æ­£åœ¨æ‰§è¡Œæµ‹è¯•...';

      try {
        const result = await test.fn();

        // ä¿å­˜ç»“æœ
        testResults[category].push({
          id: test.id,
          name: test.name,
          ...result
        });

        // æ›´æ–°UI
        element.className = `test-item ${result.status}`;
        const statusIcon = result.status === 'passed' ? 'âœ…' :
                          result.status === 'failed' ? 'âŒ' : 'âš ï¸';
        element.querySelector('.test-status').textContent = `${statusIcon} ${test.name}`;
        element.querySelector('.test-details').textContent = result.details || result.message;

        // æ›´æ–°è¿›åº¦
        completedTests++;
        updateProgress();

        // çŸ­æš‚å»¶è¿Ÿä»¥ä¾¿è§‚å¯Ÿ
        await new Promise(resolve => setTimeout(resolve, 500));
      } catch (error) {
        testResults[category].push({
          id: test.id,
          name: test.name,
          status: 'failed',
          message: 'æµ‹è¯•æ‰§è¡Œå¼‚å¸¸',
          details: error.message
        });

        element.className = 'test-item failed';
        element.querySelector('.test-status').textContent = `âŒ ${test.name}`;
        element.querySelector('.test-details').textContent = error.message;

        completedTests++;
        updateProgress();

        await new Promise(resolve => setTimeout(resolve, 500));
      }
    }

    // æ›´æ–°è¿›åº¦æ¡
    function updateProgress() {
      const percentage = testCount > 0 ? (completedTests / testCount) * 100 : 0;
      document.getElementById('progressBar').style.width = `${percentage}%`;
    }

    // å®Œæˆæµ‹è¯•
    function completeTests() {
      const corePassed = testResults.core.filter(r => r.status === 'passed').length;
      const coreTotal = testResults.core.length;
      const edgePassed = testResults.edgeCase.filter(r => r.status === 'passed').length;
      const edgeTotal = testResults.edgeCase.length;

      const summary = document.getElementById('testSummary');
      summary.innerHTML = `
        <div class="test-summary">
          <h3>æµ‹è¯•å®Œæˆç»Ÿè®¡</h3>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
            <div>
              <h4>æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•</h4>
              <p>é€šè¿‡: ${corePassed}/${coreTotal}</p>
              <div class="progress-bar">
                <div class="progress-fill" style="width: ${(corePassed/coreTotal)*100}%"></div>
              </div>
            </div>
            <div>
              <h4>è¾¹ç•Œæƒ…å†µæµ‹è¯•</h4>
              <p>é€šè¿‡: ${edgePassed}/${edgeTotal}</p>
              <div class="progress-bar">
                <div class="progress-fill" style="width: ${(edgePassed/edgeTotal)*100}%"></div>
              </div>
            </div>
          </div>
          <div style="margin-top: 20px; text-align: center;">
            <h3>æ€»ä½“ç»“æœ</h3>
            <p style="font-size: 1.2em;">
              é€šè¿‡: ${corePassed + edgePassed}/${testCount}
              (${((corePassed + edgePassed)/testCount*100).toFixed(1)}%)
            </p>
          </div>
          <div style="margin-top: 15px; text-align: center;">
            <button class="btn" onclick="openTestSite()">æ‰“å¼€ç”Ÿäº§ç¯å¢ƒéªŒè¯</button>
          </div>
        </div>
      `;
    }

    // é‡ç½®æµ‹è¯•
    function resetTests() {
      testResults.core = [];
      testResults.edgeCase = [];
      testCount = 0;
      completedTests = 0;
      hideError();
      document.getElementById('testWindowInfo').style.display = 'none';
      document.getElementById('testSummary').textContent = 'å‡†å¤‡å¼€å§‹æµ‹è¯•...';

      if (testWindow && !testWindow.closed) {
        testWindow.close();
        testWindow = null;
      }

      initializeTests();
    }

    // æµ‹è¯•å‡½æ•°å®ç°
    async function testPageLoad() {
      try {
        const testCode = `
          (function() {
            try {
              // æ£€æŸ¥é¡µé¢åŸºæœ¬å…ƒç´ 
              const hasMainContent = document.querySelector('main, .container, .app') !== null;
              const hasTitle = document.querySelector('h1, .title') !== null;

              if (!hasMainContent || !hasTitle) {
                return {
                  status: 'failed',
                  message: 'é¡µé¢åŸºæœ¬ç»“æ„ä¸å®Œæ•´',
                  details: 'ç¼ºå°‘ä¸»è¦å†…å®¹åŒºåŸŸæˆ–æ ‡é¢˜'
                };
              }

              // æ£€æŸ¥åº”ç”¨æ˜¯å¦å·²åŠ è½½
              const appElement = document.querySelector('[data-testid], .app-container, #root') ||
                                document.querySelector('script[src*="workplace-wellness"]');

              if (!appElement) {
                return {
                  status: 'failed',
                  message: 'åº”ç”¨æœªæ­£ç¡®åŠ è½½',
                  details: 'æ— æ³•æ‰¾åˆ°åº”ç”¨ç›¸å…³å…ƒç´ '
                };
              }

              return {
                status: 'passed',
                message: 'é¡µé¢åŠ è½½æˆåŠŸ',
                details: 'é¡µé¢ç»“æ„å®Œæ•´ï¼Œåº”ç”¨å·²æ­£ç¡®åŠ è½½'
              };
            } catch (error) {
              return {
                status: 'failed',
                message: 'é¡µé¢æ£€æŸ¥å¤±è´¥',
                details: error.message
              };
            }
          })()
        `;

        return await executeInTestWindow(testCode);
      } catch (error) {
        return {
          status: 'failed',
          message: 'é¡µé¢åŠ è½½æµ‹è¯•å¤±è´¥',
          details: error.message
        };
      }
    }

    async function testDataPersistence() {
      try {
        const testCode = `
          (function() {
            try {
              // æ£€æŸ¥localStorageæ•°æ®
              const hasStorage = localStorage.getItem('workplace-wellness-storage') !== null;

              // æ£€æŸ¥é¡µé¢æ•°æ®å…ƒç´ 
              const dataElements = document.querySelectorAll('[data-period], .period-data, .calendar-item, .chart-data');

              if (!hasStorage && dataElements.length === 0) {
                return {
                  status: 'warning',
                  message: 'æœªæ‰¾åˆ°æŒä¹…åŒ–æ•°æ®',
                  details: 'å¯èƒ½æ˜¯é¦–æ¬¡è®¿é—®æˆ–æ•°æ®å·²æ¸…é™¤'
                };
              }

              if (dataElements.length > 0) {
                return {
                  status: 'passed',
                  message: 'æ•°æ®æŒä¹…åŒ–æ­£å¸¸',
                  details: \`é¡µé¢æ˜¾ç¤º\${dataElements.length}ä¸ªæ•°æ®å…ƒç´ \`
                };
              }

              return {
                status: 'warning',
                message: 'æ•°æ®çŠ¶æ€æœªçŸ¥',
                details: 'localStorageæœ‰æ•°æ®ä½†é¡µé¢æœªæ˜¾ç¤º'
              };
            } catch (error) {
              return {
                status: 'failed',
                message: 'æ•°æ®æŒä¹…åŒ–æµ‹è¯•å¤±è´¥',
                details: error.message
              };
            }
          })()
        `;

        return await executeInTestWindow(testCode);
      } catch (error) {
        return {
          status: 'failed',
          message: 'æ•°æ®æŒä¹…åŒ–æµ‹è¯•å¤±è´¥',
          details: error.message
        };
      }
    }

    async function testChartDisplay() {
      try {
        const testCode = `
          (function() {
            try {
              // æŸ¥æ‰¾å›¾è¡¨å…ƒç´ 
              const chartElements = document.querySelectorAll('canvas, svg, [data-testid*="chart"], .chart, .graph');

              if (chartElements.length === 0) {
                return {
                  status: 'failed',
                  message: 'æœªæ‰¾åˆ°å›¾è¡¨å…ƒç´ ',
                  details: 'é¡µé¢å¯èƒ½æœªåŠ è½½å›¾è¡¨ç»„ä»¶'
                };
              }

              // æ£€æŸ¥å›¾è¡¨æ˜¯å¦æœ‰å†…å®¹
              let hasContent = false;
              chartElements.forEach(chart => {
                if (chart.tagName === 'CANVAS' && chart.width > 0) hasContent = true;
                if (chart.tagName === 'SVG' && chart.children.length > 0) hasContent = true;
                if (chart.querySelector && chart.querySelector('canvas, svg, path, circle, rect')) hasContent = true;
              });

              if (!hasContent) {
                return {
                  status: 'warning',
                  message: 'å›¾è¡¨å…ƒç´ å­˜åœ¨ä½†å†…å®¹ä¸ºç©º',
                  details: 'å¯èƒ½éœ€è¦ç­‰å¾…æ•°æ®åŠ è½½'
                };
              }

              return {
                status: 'passed',
                message: 'å›¾è¡¨æ˜¾ç¤ºæ­£å¸¸',
                details: \`æ‰¾åˆ°\${chartElements.length}ä¸ªå›¾è¡¨å…ƒç´ ï¼Œå†…å®¹å·²æ¸²æŸ“\`
              };
            } catch (error) {
              return {
                status: 'failed',
                message: 'å›¾è¡¨æ˜¾ç¤ºæµ‹è¯•å¤±è´¥',
                details: error.message
              };
            }
          })()
        `;

        return await executeInTestWindow(testCode);
      } catch (error) {
        return {
          status: 'failed',
          message: 'å›¾è¡¨æ˜¾ç¤ºæµ‹è¯•å¤±è´¥',
          details: error.message
        };
      }
    }

    async function testButtonPosition() {
      try {
        const testCode = `
          (function() {
            try {
              // æŸ¥æ‰¾æŒ‰é’®å…ƒç´ 
              const buttons = document.querySelectorAll('button');

              if (buttons.length === 0) {
                return {
                  status: 'warning',
                  message: 'æœªæ‰¾åˆ°æŒ‰é’®å…ƒç´ ',
                  details: 'é¡µé¢å¯èƒ½ä½¿ç”¨äº†å…¶ä»–äº¤äº’å…ƒç´ '
                };
              }

              // æ£€æŸ¥æŒ‰é’®æ˜¯å¦æœ‰åˆé€‚çš„æ ·å¼å’Œä½ç½®
              let wellPositionedButtons = 0;
              buttons.forEach(button => {
                const rect = button.getBoundingClientRect();
                const isVisible = rect.width > 0 && rect.height > 0;
                if (isVisible) wellPositionedButtons++;
              });

              if (wellPositionedButtons === 0) {
                return {
                  status: 'warning',
                  message: 'æŒ‰é’®ä½ç½®ä¸æ˜ç¡®',
                  details: 'æ‰€æœ‰æŒ‰é’®éƒ½ä¸å¯è§'
                };
              }

              return {
                status: 'passed',
                message: 'æŒ‰é’®ä½ç½®æ­£å¸¸',
                details: \`\${wellPositionedButtons}/\${buttons.length} ä¸ªæŒ‰é’®å¯è§ä¸”ä½ç½®åˆé€‚\`
              };
            } catch (error) {
              return {
                status: 'failed',
                message: 'æŒ‰é’®ä½ç½®æµ‹è¯•å¤±è´¥',
                details: error.message
              };
            }
          })()
        `;

        return await executeInTestWindow(testCode);
      } catch (error) {
        return {
          status: 'failed',
          message: 'æŒ‰é’®ä½ç½®æµ‹è¯•å¤±è´¥',
          details: error.message
        };
      }
    }

    async function testEmptyData() {
      try {
        const testCode = `
          (function() {
            try {
              // æ£€æŸ¥é¡µé¢æ˜¯å¦æœ‰ç©ºæ•°æ®çŠ¶æ€çš„å¤„ç†
              const emptyStates = document.querySelectorAll('[data-testid*="empty"], .empty-state, .no-data');
              const errorElements = document.querySelectorAll('.error, .error-message');

              if (errorElements.length > 0) {
                return {
                  status: 'warning',
                  message: 'å‘ç°é”™è¯¯å…ƒç´ ',
                  details: \`é¡µé¢æœ‰\${errorElements.length}ä¸ªé”™è¯¯å…ƒç´ \`
                };
              }

              if (emptyStates.length > 0) {
                return {
                  status: 'passed',
                  message: 'ç©ºæ•°æ®å¤„ç†æ­£å¸¸',
                  details: 'é¡µé¢æœ‰å‹å¥½çš„ç©ºçŠ¶æ€æç¤º'
                };
              }

              // æ£€æŸ¥é¡µé¢æ˜¯å¦æœ‰æ•°æ®å…ƒç´ 
              const dataElements = document.querySelectorAll('[data-period], .period-data, .calendar-item');

              if (dataElements.length === 0) {
                return {
                  status: 'warning',
                  message: 'æ— æ•°æ®å’Œç©ºçŠ¶æ€æç¤º',
                  details: 'å¯èƒ½éœ€è¦æ·»åŠ ç©ºçŠ¶æ€å¤„ç†'
                };
              }

              return {
                status: 'passed',
                message: 'é¡µé¢æ­£å¸¸æ˜¾ç¤ºæ•°æ®',
                details: 'é¡µé¢æœ‰æ•°æ®ï¼Œæ— éœ€ç©ºçŠ¶æ€å¤„ç†'
              };
            } catch (error) {
              return {
                status: 'warning',
                message: 'ç©ºæ•°æ®æµ‹è¯•æ— æ³•å®Œæˆ',
                details: error.message
              };
            }
          })()
        `;

        return await executeInTestWindow(testCode);
      } catch (error) {
        return {
          status: 'warning',
          message: 'ç©ºæ•°æ®æµ‹è¯•æ— æ³•å®Œæˆ',
          details: error.message
        };
      }
    }

    async function testLargeData() {
      try {
        const testCode = `
          (function() {
            try {
              // æ£€æŸ¥é¡µé¢æ•°æ®é‡
              const dataElements = document.querySelectorAll('[data-period], .period-data, .calendar-item, .chart-point');
              const dataCount = dataElements.length;

              if (dataCount < 5) {
                return {
                  status: 'warning',
                  message: 'æ•°æ®é‡è¾ƒå°‘',
                  details: \`å½“å‰æ•°æ®é‡: \${dataCount}\`
                };
              }

              // ç®€å•çš„æ€§èƒ½æ£€æŸ¥
              const startTime = performance.now();
              const chartElements = document.querySelectorAll('canvas, svg, .chart');
              const endTime = performance.now();

              const renderTime = endTime - startTime;

              return {
                status: 'passed',
                message: 'æ€§èƒ½æµ‹è¯•é€šè¿‡',
                details: \`æ•°æ®é‡: \${dataCount}, æ£€æŸ¥è€—æ—¶: \${renderTime.toFixed(2)}ms\`
              };
            } catch (error) {
              return {
                status: 'warning',
                message: 'æ€§èƒ½æµ‹è¯•æ— æ³•å®Œæˆ',
                details: error.message
              };
            }
          })()
        `;

        return await executeInTestWindow(testCode);
      } catch (error) {
        return {
          status: 'warning',
          message: 'å¤§é‡æ•°æ®æµ‹è¯•æ— æ³•å®Œæˆ',
          details: error.message
        };
      }
    }

    async function testSecurity() {
      try {
        const testCode = `
          (function() {
            try {
              // æ£€æŸ¥é¡µé¢æ˜¯å¦æœ‰æ˜æ˜¾çš„å®‰å…¨é—®é¢˜
              const errorElements = document.querySelectorAll('.error, .error-message, [data-testid*="error"]');

              if (errorElements.length > 0) {
                return {
                  status: 'warning',
                  message: 'å‘ç°é”™è¯¯å…ƒç´ ',
                  details: \`æ‰¾åˆ°\${errorElements.length}ä¸ªé”™è¯¯å…ƒç´ \`
                };
              }

              // æ£€æŸ¥æ˜¯å¦æœ‰æ˜æ˜¾çš„æ•æ„Ÿä¿¡æ¯æ³„éœ²
              const scripts = document.querySelectorAll('script');
              let sensitiveInfoCount = 0;

              scripts.forEach(script => {
                if (script.textContent) {
                  const hasPasswords = /password|passwd|pwd/i.test(script.textContent);
                  const hasApiKeys = /api[_-]?key|secret|token/i.test(script.textContent);

                  if (hasPasswords || hasApiKeys) {
                    sensitiveInfoCount++;
                  }
                }
              });

              if (sensitiveInfoCount > 0) {
                return {
                  status: 'warning',
                  message: 'å‘ç°æ½œåœ¨æ•æ„Ÿä¿¡æ¯',
                  details: \`æ£€æµ‹åˆ°\${sensitiveInfoCount}å¤„å¯èƒ½çš„æ•æ„Ÿä¿¡æ¯\`
                };
              }

              return {
                status: 'passed',
                message: 'å®‰å…¨æ€§æ£€æŸ¥é€šè¿‡',
                details: 'æœªå‘ç°æ˜æ˜¾çš„å®‰å…¨é—®é¢˜'
              };
            } catch (error) {
              return {
                status: 'warning',
                message: 'å®‰å…¨æ€§æµ‹è¯•æ— æ³•å®Œæˆ',
                details: error.message
              };
            }
          })()
        `;

        return await executeInTestWindow(testCode);
      } catch (error) {
        return {
          status: 'warning',
          message: 'å®‰å…¨æ€§æµ‹è¯•æ— æ³•å®Œæˆ',
          details: error.message
        };
      }
    }

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', initializeTests);
  </script>
</body>
</html>
