name: ğŸ” ç¿»è¯‘é”®å®Œæ•´æ€§éªŒè¯

on:
  push:
    branches: [ main, develop, feature/* ]
  pull_request:
    branches: [ main, develop ]

jobs:
  validate-translations:
    name: éªŒè¯ç¿»è¯‘é”®
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout ä»£ç 
        uses: actions/checkout@v4

      - name: ğŸ”§ è®¾ç½® Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: ğŸ“¦ å®‰è£…ä¾èµ–
        run: npm ci

      - name: ğŸ” éªŒè¯ JSON è¯­æ³•
        run: |
          echo "ğŸ” éªŒè¯ JSON è¯­æ³•..."
          node -e "JSON.parse(require('fs').readFileSync('messages/zh.json', 'utf8'))" || exit 1
          node -e "JSON.parse(require('fs').readFileSync('messages/en.json', 'utf8'))" || exit 1
          echo "âœ… JSON è¯­æ³•éªŒè¯é€šè¿‡"

      - name: ğŸ” æ£€æŸ¥ç¿»è¯‘é”®åŒæ­¥
        run: |
          echo "ğŸ” æ£€æŸ¥ç¿»è¯‘é”®åŒæ­¥..."
          node scripts/check-translation-sync.js

      - name: ğŸ” ç”Ÿæˆç¿»è¯‘ç±»å‹
        run: |
          echo "ğŸ” ç”Ÿæˆç¿»è¯‘ç±»å‹å®šä¹‰..."
          node scripts/generate-translation-types.js

      - name: ğŸ” TypeScript ç±»å‹æ£€æŸ¥
        run: |
          echo "ğŸ” è¿è¡Œ TypeScript ç±»å‹æ£€æŸ¥..."
          npm run type-check

      - name: ğŸ” ESLint æ£€æŸ¥
        run: |
          echo "ğŸ” è¿è¡Œ ESLint æ£€æŸ¥..."
          npm run lint:full || true

      - name: ğŸ“Š ç”ŸæˆéªŒè¯æŠ¥å‘Š
        if: always()
        run: |
          echo "ğŸ“Š ç”ŸæˆéªŒè¯æŠ¥å‘Š..."
          node scripts/generate-validation-report.js

      - name: ğŸ“¤ ä¸Šä¼ éªŒè¯æŠ¥å‘Š
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: translation-validation-report
          path: |
            translation-validation-report.html
            translation-validation-report.json
          retention-days: 30

      - name: âœ… éªŒè¯å®Œæˆ
        run: |
          echo "âœ… æ‰€æœ‰ç¿»è¯‘é”®éªŒè¯é€šè¿‡ï¼"
